---
- name: Include vars of role java-ap
  include_vars:
    file: ../../vars/main.yml
    name: man_vars
- name: Show APP_NAME
  debug:
    msg: 
    - "APP_NAME = {{ man_vars.app_name }}"
    - "EMAILTO = {{ man_vars.emailto }}" 
- name: Check webserver for correct response
  uri:
    url: "http://{{ hostvars[inventory_hostname]['ansible_host'] }}:8080/{{  man_vars.app_name }}/status.html"
    return_content: yes
  retries: 10
  delay: 1
  register: result
  delegate_to: localhost
- name: show result
  debug:
    msg: "{{ inventory_hostname }} service status is OK"
  when: result.status == 200

- name: Sending notification email for App deployment
  mail:
    host: smtp.gmail.com
    port: 465
    username: sleepyjoeyu
    password: dj96k88r
    to: "{{ man_vars.emailto }}"
    subject: Ansible Report for App Deployment
    body: "{{ app_name }} has been successfully deployed with {{ war_file }}"
  delegate_to: localhost
  when: man_vars.emailto is defined
